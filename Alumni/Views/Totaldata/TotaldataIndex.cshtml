
@{
    ViewBag.Title = "TotaldataIndex";
}
<head>
    <title>总数据查询</title>
</head>
<body>
    <h2>总数据查询</h2><br />
    <div>
        <div class="d-flex mb-2">
            <hr>
            <span class="item-title">单据类型</span>
            <select ID="Form_Name" name="Form_Name" runat="server" class="col-sm-12 col-md-6 col-xl-2">
                <option value="">------------请选择------------</option>
                <option th:each="Form_Name:${list}" th:value="${Form_Name.value}" th:text="${Form_Name.text}" hidden ></option>
            </select>

            <span class="item-title">学生手机号/学生学号</span>
            <input ID="Stu_Empno" name="Stu_Empno" runat="server" class="col-sm-12 col-md-6 col-xl-2" />
            <span class="item-title">审核状态</span>
            <select ID="IS_PASS" name="IS_PASS" runat="server" class="col-sm-12 col-md-6 col-xl-2">
                <option value="">------------请选择------------</option>
                <option th:each="IS_PASS:${list}" th:value="${IS_PASS.value}" th:text="${IS_PASS.text}" ng-selected="" hidden></option>
            </select>
            <button id="btn_search" type="button" class="btn btn-primary ms-2">搜索</button>
            <button id="btn_export" class="btn btn-info ms-2" data-table="#table" type="button">下载汇出</button>
        </div>
        <table id="table"></table>

    </div>

</body>
<script src="~/static/js/bootstrap-table.js" data-cf-settings="4bebc94b2db97a1f9680a39f-|49" defer=""></script>
<script type="text/javascript">
    $(function () {

        $.ajax({
            type: "get",
            dataType: "json",
            method: "post",
            url: "@(Url.Action("getAuditState", "DDL"))",
            data: "doaction=sectionList",
            success: function (result) {
                var len = result.length;
                for (i = 0; i < len; i++) {
                    $("#IS_PASS").append(`<option value="${result[i].VALUE}">${result[i].TEXT}</option>`);
                }
            }
        });

        $.ajax({
            type: "get",
            dataType: "json",
            method: "post",
            url: "@(Url.Action("getFormName", "DDL"))",
            data: "doaction=sectionList",
            success: function (result) {
                var len = result.length;
                for (i = 0; i < len; i++) {
                    if (result[i].VALUE == 'P0000001') {
                        //过滤此选项
                    } else {
                        $("#Form_Name").append(`<option value="${result[i].VALUE}">${result[i].TEXT}</option>`);
                    }
                }
            }
        });

                $('#table').bootstrapTable('destroy');
                $('#table').bootstrapTable({
                    ajax: function (request) {
                        var model = {
                            "IS_PASS": $("#IS_PASS").val(),
                            "Form_Name": $("#Form_Name").val(),
                            "Stu_Empno": $("#Stu_Empno").val(),
                        }
                        request.data = model;
                        $.ajax({
                            type: "post",
                            url:"@(Url.Action("GetData", "Totaldata"))",
                            contentType: "application/json;charset=UTF-8",
                            data: JSON.stringify(request.data),
                            dataType: "json",
                            jsonp: 'callback',
                            success: function (msg) {
                                request.success({
                                    rows: msg
                                });
                                $('#table').bootstrapTable('load', msg);
                            },
                            error: function () {
                                alert("错误");
                            }
                        });
                    },
                    toolbar: '#toolbar',
                    singleSelect: true,
                    clickToSelect: true,
                    sortName: "AddTime",
                    sortOrder: "desc",
                    cache: false,
                    striped: true,
                    pageSize: 10,
                    pageNumber: 1,
                    pageList: "[15, 25, 50, 100, All]",
                    showToggle: true,
                    showRefresh: true,
                    showColumns: false,
                    search: false,
                    pagination: true,
                    columns: [
                    //{
                    //    field: "mchSeqNo",
                    //    checkbox: true,
                    //    },
                    {
                        field: 'Form_Name',
                        title: '单据名称',
                        switchable: true
                    }, {
                        field: 'IS_PASS',
                        title: '审核状态',
                        switchable: true
                    }, {
                        field: 'Stu_Empno',
                        title: '学号',
                        switchable: true
                    }, {
                        field: 'Stu_Name',
                        title: '姓名',
                        switchable: true,
                        sortable: true
                    }, {
                        field: 'EmailAdress',
                        title: '邮件/邮箱地址',
                        switchable: true
                    }, {
                        field: 'Phone',
                        title: '手机号',
                        switchable: true
                    }, {
                        field: 'AddTime',
                        title: '提交时间',
                        switchable: true
                    }],
                });

                $('#btn_export').click(function () {
                    var IS_PASS = $("#IS_PASS").val();
                    var Stu_Empno = $("#Stu_Empno").val();
                    var Form_Name = $("#Form_Name").val();
                    var url = "@(Url.Action("TotaldataExport", "Totaldata"))" + "?IS_PASS=" + IS_PASS + "&Stu_Empno=" + Stu_Empno + "&Form_Name=" + Form_Name;             
                    window.location = url;
                });

                $('#btn_search').click(function () {
                    $('#table').bootstrapTable('refresh', { pageNumber: 1 });
                });
            });
</script>

